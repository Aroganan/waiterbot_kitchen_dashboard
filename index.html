<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <title>Document</title>
</head>
<body>
    <div class="container mt-3">
        <table class="table table-dark">
            <thead>
                <tr>
                    <th>Table-No</th>
                    <th>Dishes</th>
                    <th>Counts</th>
                    <th>Action</th>
                </tr>
            </thead>
            <tbody id="tbody1"></tbody>
        </table>
    </div>
</body>

<script type="module">
    // Import the functions you need from the SDKs you need
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-app.js";
    import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-database.js";

    // Your web app's Firebase configuration
    const firebaseConfig = {
        apiKey: "AIzaSyA6Fnu2c0eiszLQ3gbRm62j-SV3ETBxSmY",
        authDomain: "wbot-7488c.firebaseapp.com",
        databaseURL: "https://wbot-7488c-default-rtdb.asia-southeast1.firebasedatabase.app",
        projectId: "wbot-7488c",
        storageBucket: "wbot-7488c.appspot.com",
        messagingSenderId: "699872450961",
        appId: "1:699872450961:web:37a2fbcf1adbaaa871a230"
    };

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    const tbody = document.getElementById('tbody1');

    function AddItemToTable(tableNo, dish, count, rowId){
        let trow = document.createElement("tr");
        trow.id = rowId; // Set the row ID

        let td1 = document.createElement("td");
        let td2 = document.createElement("td");
        let td3 = document.createElement("td");
        let td4 = document.createElement("td");

        td1.innerHTML = tableNo;
        td2.innerHTML = dish;
        td3.innerHTML = count;

        // Create the Tick button
        let tickButton = document.createElement("button");
        tickButton.innerHTML = "Tick";
        tickButton.className = "btn btn-success";
        tickButton.onclick = function() {
            markRowAsCompleted(rowId, tickButton, trow); // Call function to mark as completed
        };

        td4.appendChild(tickButton);

        trow.appendChild(td1);
        trow.appendChild(td2);
        trow.appendChild(td3);
        trow.appendChild(td4);

        tbody.appendChild(trow);
    }

    function GetAllDataRealTime(){
        const dbRef = ref(db, 'tables_and_items'); // Reference to the "tables_and_items" node

        onValue(dbRef, (snapshot) => {
            tbody.innerHTML = ""; // Clear the table body before adding new rows
            const data = snapshot.val();

            // Iterate over each table (01, 02, 03, etc.)
            for (const key in data) {
                if (data.hasOwnProperty(key)) {
                    const tableData = data[key];
                    const tableNo = tableData.Table_No;
                    const orderedItems = tableData.Ordered_Item;

                    orderedItems.forEach((item, index) => {
                        const rowId = `${tableNo}-${index}`; // Create a unique ID for each row
                        AddItemToTable(tableNo, item, index + 1, rowId); // Count as index + 1
                    });
                }
            }
        });
    }

    function markRowAsCompleted(rowId, button, row) {
        // Change the button text to "Ticked"
        button.innerHTML = "Ticked";
        button.className = "btn btn-secondary"; // Change button color to indicate it's been ticked
        button.disabled = true; // Disable the button after ticking

        // Move the row to the bottom of the table
        tbody.removeChild(row); // Remove the row from its current position
        tbody.appendChild(row); // Re-append it, which moves it to the bottom
    }

    window.onload = GetAllDataRealTime;
</script>

</html>
